<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Acoustic cylindrical T-Matrices &#8212; acoustotreams 0.1.40 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=0c472235" />
    <link rel="stylesheet" type="text/css" href="_static/pyramid.css?v=424f8d56" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=f4ec84db" />
    <script src="_static/documentation_options.js?v=967b4925"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Acoustic S-Matrices for plane waves" href="smatrix.html" />
    <link rel="prev" title="Acoustic T-Matrices" href="tmatrix.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="smatrix.html" title="Acoustic S-Matrices for plane waves"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tmatrix.html" title="Acoustic T-Matrices"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">acoustotreams 0.1.40 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="intro.html" accesskey="U">Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Acoustic cylindrical T-Matrices</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="acoustic-cylindrical-t-matrices">
<h1>Acoustic cylindrical T-Matrices<a class="headerlink" href="#acoustic-cylindrical-t-matrices" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#infinitely-long-cylinders" id="id1">Infinitely long cylinders</a></p></li>
<li><p><a class="reference internal" href="#cylindrical-t-matrices-for-one-dimensional-arrays-of-spherical-t-matrices" id="id2">Cylindrical T-matrices for one-dimensional arrays of spherical T-matrices</a></p></li>
<li><p><a class="reference internal" href="#clusters" id="id3">Clusters</a></p></li>
<li><p><a class="reference internal" href="#one-dimensional-arrays-along-the-x-axis" id="id4">One-dimensional arrays (along the x axis)</a></p></li>
<li><p><a class="reference internal" href="#two-dimensional-arrays-in-the-xy-plane" id="id5">Two-dimensional arrays (in the xy plane)</a></p></li>
</ul>
</nav>
<p>Here, we cover acoustical cylindrical T-matrices, which are distinguished from the more
conventional (spherical) T-matrices through the use of scalar cylindrical waves as the
basis instead of scalar spherical waves. These waves are parametrized by the z component
of the wave vector <span class="math notranslate nohighlight">\(k_z\)</span>, which describes their behavior in the z direction
<span class="math notranslate nohighlight">\(\mathrm e^{\mathrm i k_z z}\)</span>, and the azimuthal order <span class="math notranslate nohighlight">\(m\)</span>, which is also
used in scalar spherical waves.</p>
<p>The cylindrical T-matrices are suited for structures that are periodic in one dimension
(conventionally set along the z axis). Similarly to T-matrices of spheres that contain
the analytically known Mie coefficients, the cylindrical T-matrices for infinitely long
cylinders can also be calculated analytically.</p>
<p>Another similarity to spherical T-matrices are the possibilities to describe clusters of
objects in a local and global basis and to place these objects in a lattice. The
lattices can only extend in one and two dimensions; the z direction is implicitly
periodic already.</p>
<section id="infinitely-long-cylinders">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Infinitely long cylinders</a><a class="headerlink" href="#infinitely-long-cylinders" title="Link to this heading">¶</a></h2>
<p>The first simple object, for which we calculate the cylindrical T-matrix is an
infinitely long cylinder. Due to the rotation symmetry about the z axis this matrix
is diagonal with respect to <code class="code docutils literal notranslate"><span class="pre">m</span></code> and due to the translation symmetry
it is also diagonal with respect to <code class="code docutils literal notranslate"><span class="pre">kz</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">500000</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">/</span> <span class="mi">343</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">1050</span> <span class="o">+</span> <span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">2350</span> <span class="o">-</span> <span class="mi">300</span><span class="n">j</span><span class="p">),</span> 
             <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">998</span><span class="p">,</span> <span class="mi">1497</span><span class="p">)]</span>
<span class="n">kzs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">mmax</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">cylinders</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">kzs</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">materials</span><span class="p">)</span> <span class="k">for</span> <span class="n">k0</span> <span class="ow">in</span> <span class="n">k0s</span><span class="p">]</span>
</pre></div>
</div>
<p>For such infinitely long structures it makes more sense to talk about cross width
instead of cross section. We obtain the averaged scattering and extinction cross width
by</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xw_sca</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tm</span><span class="o">.</span><span class="n">xw_sca_avg</span> <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">cylinders</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
<span class="n">xw_ext</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tm</span><span class="o">.</span><span class="n">xw_ext_avg</span> <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">cylinders</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, we can also select specific modes only, for example the modes with <span class="math notranslate nohighlight">\(m = 0\)</span> and <span class="math notranslate nohighlight">\(m = \pm 1\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cwb_mmax0</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">ScalarCylindricalWaveBasis</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">kzs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">cylinders_mmax0</span> <span class="o">=</span> <span class="p">[</span><span class="n">tm</span><span class="p">[</span><span class="n">cwb_mmax0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">cylinders</span><span class="p">]</span>
<span class="n">xw_sca_mmax0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tm</span><span class="o">.</span><span class="n">xw_sca_avg</span> <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">cylinders_mmax0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
<span class="n">xw_ext_mmax0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">tm</span><span class="o">.</span><span class="n">xw_ext_avg</span> <span class="k">for</span> <span class="n">tm</span> <span class="ow">in</span> <span class="n">cylinders_mmax0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">radius</span><span class="p">)</span>
</pre></div>
</div>
<p>to calculate their cross width. Evaluating the field intensity in the xy plane is similar to the case of a sphere.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tm</span> <span class="o">=</span> <span class="n">cylinders</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">plane_wave_scalar</span><span class="p">([</span><span class="n">tm</span><span class="o">.</span><span class="n">k0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">k0</span><span class="o">=</span><span class="n">tm</span><span class="o">.</span><span class="n">k0</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">tm</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">tm</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0075</span><span class="p">,</span> <span class="mf">0.0075</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.0075</span><span class="p">,</span> <span class="mf">0.0075</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_intensity</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>  
    <span class="k">if</span> <span class="n">tm</span><span class="o">.</span><span class="n">valid_points</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="p">[</span><span class="n">radius</span><span class="p">]):</span> 
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">inc</span><span class="o">.</span><span class="n">pfield</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">sca</span><span class="o">.</span><span class="n">pfield</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>  
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">result</span>  
<span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">compute_intensity</span><span class="p">)(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">intensity</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</pre></div>
</div>
<p>For the infinite cylinder we can also calculate the radiation pattern as a function of the angle <span class="math notranslate nohighlight">\(\varphi\)</span>.
The red arrow indicates the direction of incidence of the plane wave.</p>
<p>(<a class="reference download internal" download="" href="_downloads/439d9446b2fe66af91ef9ddd9f09c970/cylinder_tmatrixc.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
</section>
<section id="cylindrical-t-matrices-for-one-dimensional-arrays-of-spherical-t-matrices">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Cylindrical T-matrices for one-dimensional arrays of spherical T-matrices</a><a class="headerlink" href="#cylindrical-t-matrices-for-one-dimensional-arrays-of-spherical-t-matrices" title="Link to this heading">¶</a></h2>
<p>For our next example we want to look at the system of spheres on a one-dimensional
lattice again (<a class="reference internal" href="tmatrix.html#one-dimensional-arrays-along-z"><span class="std std-ref">One-dimensional arrays (along z)</span></a>). They fulfil all
properties that define structures where the use of cylindrical waves is beneficial,
namely they have a finite extent in the xy plane and they are periodic along the
z direction.</p>
<p>Thus, the initial setup of our calculation starts with spheres in the spherical wave
basis and placing them in a chain. This is the same procedure as in
<a class="reference internal" href="tmatrix.html#one-dimensional-arrays-along-z"><span class="std std-ref">One-dimensional arrays (along z)</span></a>. We define a nonzero component of
the wave vector along the z axis <span class="math notranslate nohighlight">\(k_z\)</span> in the air.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">50000</span> <span class="o">/</span> <span class="mi">343</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">1050</span> <span class="o">+</span> <span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">2350</span> <span class="o">-</span> <span class="mi">300</span><span class="n">j</span><span class="p">),</span> 
            <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">998</span><span class="p">,</span> <span class="mi">1497</span><span class="p">)]</span>
<span class="n">lmax</span> <span class="o">=</span> <span class="n">mmax</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0075</span><span class="p">,</span> <span class="mf">0.0065</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">0.004</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0075</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.004</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.0075</span><span class="p">]]</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">0.035</span>
<span class="n">lattice</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">k0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1497</span> <span class="o">/</span> <span class="mi">343</span>

<span class="n">spheres</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrix</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">materials</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">radii</span><span class="p">]</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrix</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">spheres</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">latticeinteraction</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">kz</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we also define <span class="math notranslate nohighlight">\(n\)</span> as a “refractive index” for the background medium of the spheres
with respect to the air and divide <span class="math notranslate nohighlight">\(k_z\)</span> by <span class="math notranslate nohighlight">\(n\)</span> when it is needed. Next, we convert
this chain in the spherical wave basis to a suitable cylindrical wave basis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bmax</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">*</span> <span class="n">lattice</span><span class="o">.</span><span class="n">reciprocal</span>
<span class="n">cwb</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">ScalarCylindricalWaveBasis</span><span class="o">.</span><span class="n">diffr_orders</span><span class="p">(</span><span class="n">kz</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">bmax</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>
<span class="n">chain_tmc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">cwb</span><span class="p">)</span>
</pre></div>
</div>
<p>We chose to add the first three diffraction orders (plus a 0.1 margin to avoid problems
with floating point comparisons).</p>
<p>Finally, we set-up the incident wave and calculate the scattering coeffcients by the usual
procedure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">inc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">plane_wave_scalar</span><span class="p">(</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">chain</span><span class="o">.</span><span class="n">k0</span> <span class="o">*</span> <span class="n">chain</span><span class="o">.</span><span class="n">k0</span> <span class="o">-</span> <span class="n">kz</span> <span class="o">*</span> <span class="n">kz</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kz</span><span class="p">],</span> 
    <span class="n">k0</span><span class="o">=</span><span class="n">chain</span><span class="o">.</span><span class="n">k0</span><span class="p">,</span> 
    <span class="n">material</span><span class="o">=</span><span class="n">chain</span><span class="o">.</span><span class="n">material</span>
<span class="p">)</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
<span class="n">sca_tmc</span> <span class="o">=</span> <span class="n">chain_tmc</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
</pre></div>
</div>
<p>We evaluate the fields in two regions. Outside of the circumscribing cylinders we can
use the fast cylindrical wave expansion. Inside of the circumscribing cylinders but
outside of the spheres we can use the method of
<a class="reference internal" href="tmatrix.html#one-dimensional-arrays-along-z"><span class="std std-ref">One-dimensional arrays (along z)</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.75</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mf">0.75</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  
    <span class="k">if</span> <span class="n">chain_tmc</span><span class="o">.</span><span class="n">valid_points</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">radii</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sca_tmc</span><span class="o">.</span><span class="n">pfield</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">chain</span><span class="o">.</span><span class="n">valid_points</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">radii</span><span class="p">):</span>
            <span class="n">swb</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">ScalarSphericalWaveBasis</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">expandlattice</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">swb</span><span class="p">)</span><span class="o">.</span><span class="n">pfield</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">result</span>  
<span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">compute_pressure</span><span class="p">)(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> 
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">complex</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</pre></div>
</div>
<p>Finally, we can plot the results. To illustrate the periodicity better, three unit cells
are shown.</p>
<p>(<a class="reference download internal" download="" href="_downloads/8143539ded379652095ce7a6269597fb/chain_tmatrixc.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
</section>
<section id="clusters">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Clusters</a><a class="headerlink" href="#clusters" title="Link to this heading">¶</a></h2>
<p>Similarly to the case of spheres we can also calculate the response from a cluster of
objects. As an example let us simulate a cylinder together with a chain of spheres
in the cylindrical wave basis as described in the previous section.</p>
<p>Hence, we set up first the spheres in the chain and convert them to the cylindrical wave
basis as before</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">50000</span> <span class="o">/</span> <span class="mi">343</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">1050</span> <span class="o">+</span> <span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">2350</span> <span class="o">-</span> <span class="mi">300</span><span class="n">j</span><span class="p">),</span> 
            <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">998</span><span class="p">,</span> <span class="mi">1497</span><span class="p">)]</span>
<span class="n">lmax</span> <span class="o">=</span> <span class="n">mmax</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0065</span><span class="p">,</span> <span class="mf">0.0055</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">0.004</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.005</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">0.035</span>
<span class="n">lattice</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">k0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1497</span> <span class="o">/</span> <span class="mi">343</span>

<span class="n">sphere</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrix</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">materials</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">latticeinteraction</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">kz</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="n">bmax</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">*</span> <span class="n">lattice</span><span class="o">.</span><span class="n">reciprocal</span>
<span class="n">cwb</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">ScalarCylindricalWaveBasis</span><span class="o">.</span><span class="n">diffr_orders</span><span class="p">(</span><span class="n">kz</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">bmax</span><span class="p">)</span>
<span class="n">chain_tmc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">cwb</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, we create the T-matrix of the cylinder in the cylindrical wave basis.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cylinder</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cwb</span><span class="o">.</span><span class="n">kz</span><span class="p">),</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">materials</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we construct the cluster, find the T-matrix of the interacting system,
and then scattered field coeffcients for the incident plane wave.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">cluster</span><span class="p">([</span><span class="n">chain_tmc</span><span class="p">,</span> <span class="n">cylinder</span><span class="p">],</span> <span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">plane_wave_scalar</span><span class="p">(</span>
    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">k0</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">k0</span> <span class="o">-</span> <span class="n">kz</span> <span class="o">*</span> <span class="n">kz</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kz</span><span class="p">],</span> 
    <span class="n">k0</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">k0</span><span class="p">,</span> 
    <span class="n">material</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">material</span>
<span class="p">)</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
</pre></div>
</div>
<p>The scattered pressure field within three unit cells is shown below</p>
<p>(<a class="reference download internal" download="" href="_downloads/6057aca12788be16d8950609a968b025/cluster_tmatrixc.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
</section>
<section id="one-dimensional-arrays-along-the-x-axis">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">One-dimensional arrays (along the x axis)</a><a class="headerlink" href="#one-dimensional-arrays-along-the-x-axis" title="Link to this heading">¶</a></h2>
<p>Now, we take the chain of spheres and cylinder and place them in a grating structure
along the x direction. We start again by defining the parameters and calculating the
relevant cylindrical T-matrices.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0</span> <span class="o">=</span>  <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">50000</span> <span class="o">/</span> <span class="mi">343</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">1050</span> <span class="o">+</span> <span class="mi">100</span><span class="n">j</span><span class="p">,</span> <span class="mi">2350</span> <span class="o">-</span> <span class="mi">300</span><span class="n">j</span><span class="p">),</span> 
            <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">998</span><span class="p">,</span> <span class="mi">1497</span><span class="p">)]</span>
<span class="n">lmax</span> <span class="o">=</span> <span class="n">mmax</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">radii</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0065</span><span class="p">,</span> <span class="mf">0.0055</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">0.004</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.005</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">period</span> <span class="o">=</span> <span class="mf">0.035</span>
<span class="n">lattice_z</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">lattice_x</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span>
<span class="n">kz</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">k0</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1497</span> <span class="o">/</span> <span class="mi">343</span>

<span class="n">sphere</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrix</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span><span class="n">lmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">radii</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">materials</span><span class="p">)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">sphere</span><span class="o">.</span><span class="n">latticeinteraction</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">lattice_z</span><span class="p">,</span> <span class="n">kz</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
<span class="n">bmax</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="o">*</span> <span class="n">lattice_z</span><span class="o">.</span><span class="n">reciprocal</span>
<span class="n">cwb</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">ScalarCylindricalWaveBasis</span><span class="o">.</span><span class="n">diffr_orders</span><span class="p">(</span><span class="n">kz</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">lattice_z</span><span class="p">,</span> <span class="n">bmax</span><span class="p">)</span>
<span class="n">kzs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">cwb</span><span class="o">.</span><span class="n">kz</span><span class="p">)</span>
<span class="n">chain_tmc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">from_array</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">cwb</span><span class="p">)</span>
<span class="n">cylinder</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">kzs</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">radii</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">materials</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we create the cluster and, as usual, let it interact within a lattice of the
defined periodicity. Then, we simply calculate the scattering coefficients.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cluster</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span>
    <span class="p">[</span><span class="n">chain_tmc</span><span class="p">,</span> <span class="n">cylinder</span><span class="p">],</span> <span class="n">positions</span>
<span class="p">)</span><span class="o">.</span><span class="n">latticeinteraction</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">lattice_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">inc</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">plane_wave_scalar</span><span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">k0</span> <span class="o">*</span> <span class="n">cluster</span><span class="o">.</span><span class="n">k0</span> <span class="o">-</span> <span class="n">kz</span> <span class="o">*</span> <span class="n">kz</span><span class="p">),</span> <span class="n">kz</span><span class="p">],</span> 
    <span class="n">k0</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">k0</span><span class="p">,</span> 
    <span class="n">material</span><span class="o">=</span><span class="n">cluster</span><span class="o">.</span><span class="n">material</span>
<span class="p">)</span>
<span class="n">sca</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span>
</pre></div>
</div>
<p>In the last step, we sum up the scattered fields at each point we want to calculate
the pressure field.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">period</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_pressure</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  
    <span class="k">if</span> <span class="n">cluster</span><span class="o">.</span><span class="n">valid_points</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">radii</span><span class="p">):</span>
        <span class="n">cwb</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">ScalarCylindricalWaveBasis</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">kzs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sca</span><span class="o">.</span><span class="n">expandlattice</span><span class="p">(</span><span class="n">basis</span><span class="o">=</span><span class="n">cwb</span><span class="p">)</span><span class="o">.</span><span class="n">pfield</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">result</span>  
<span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
    <span class="n">delayed</span><span class="p">(</span><span class="n">compute_pressure</span><span class="p">)(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">))</span> 
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nb">complex</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</pre></div>
</div>
<p>and plot the results.</p>
<p>(<a class="reference download internal" download="" href="_downloads/8edc86f47f81c9761a5e6a5e4cef8572/grating_tmatrixc.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>)</p>
</section>
<section id="two-dimensional-arrays-in-the-xy-plane">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Two-dimensional arrays (in the xy plane)</a><a class="headerlink" href="#two-dimensional-arrays-in-the-xy-plane" title="Link to this heading">¶</a></h2>
<p>As the last example, let us examine a structure that is a crystal consisting
of infinitely long cylinders in a square array in the xy plane.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k0s</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">115000</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span> <span class="o">/</span> <span class="mi">343</span>
<span class="n">materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">1050</span><span class="p">,</span> <span class="mi">2350</span><span class="p">),</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticMaterial</span><span class="p">(</span><span class="mi">998</span><span class="p">,</span> <span class="mi">1497</span><span class="p">)]</span>
<span class="n">mmax</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">lattice</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">Lattice</span><span class="o">.</span><span class="n">cubic</span><span class="p">(</span><span class="mf">0.015</span><span class="p">)</span>
<span class="n">kpar</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">compute_svd</span><span class="p">(</span><span class="n">k0</span><span class="p">):</span>
    <span class="n">cyl</span> <span class="o">=</span> <span class="n">acoustotreams</span><span class="o">.</span><span class="n">AcousticTMatrixC</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">kpar</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">materials</span><span class="p">)</span>
    <span class="n">svd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">cyl</span><span class="o">.</span><span class="n">latticeinteraction</span><span class="p">(</span><span class="n">lattice</span><span class="p">,</span> <span class="n">kpar</span><span class="p">[:</span><span class="mi">2</span><span class="p">]),</span> <span class="n">compute_uv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">svd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="n">compute_svd</span><span class="p">)(</span><span class="n">k0s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k0s</span><span class="p">)))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (kHz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Smallest singular value&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="mi">343</span> <span class="o">*</span> <span class="n">k0s</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Similarly to the case of spheres and a three-dimensional lattice, we can check the
smallest singular value.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="intro.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="acoustotreams.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev.html">Development and contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="tmatrix.html"
                          title="previous chapter">Acoustic T-Matrices</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="smatrix.html"
                          title="next chapter">Acoustic S-Matrices for plane waves</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tmatrixc.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="smatrix.html" title="Acoustic S-Matrices for plane waves"
             >next</a> |</li>
        <li class="right" >
          <a href="tmatrix.html" title="Acoustic T-Matrices"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">acoustotreams 0.1.40 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="intro.html" >Examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Acoustic cylindrical T-Matrices</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2024, Nikita Ustimenko.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>